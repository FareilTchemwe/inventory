<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
      rel="stylesheet"
    />
    <link href="css/login.css" rel="stylesheet" />
    <title>Edit Product - Dress Store</title>
  </head>

  <body>
    <header>
      <h1>Dress Store</h1>
    </header>
    <!-- Back Icon -->
    <a href="javascript:history.back()" class="back-icon">
      <i class="fas fa-arrow-left"></i> Back
    </a>

    <main>
      <div class="login-container">
        <h2>Edit Dress</h2>
        <form id="edit-product-form">
          <input type="hidden" id="product-id" />
          <label>Name</label>
          <input type="text" id="name" required />

          <label>Size</label>
          <input type="text" id="size" required />

          <label>Color</label>
          <input type="text" id="color" required />

          <label>Price</label>
          <input type="number" id="price" required />

          <label>Quantity</label>
          <input type="number" id="quantity" required />

          <label>Threshold Quantity</label>
          <input type="number" id="threshold" required />

          <label>Status</label>
          <select id="status" required>
            <option value="available">Available</option>
            <option value="nearly finished">Low</option>
            <option value="finished">Finished</option>
          </select>

          <button type="button" class="login-button" onclick="updateProduct()">
            Save
          </button>
        </form>
      </div>
    </main>

    <footer>
      <p>&copy; 2024 Dress Store. All rights reserved.</p>
    </footer>

    <script>
      // Load product details from URL query parameters
      const urlParams = new URLSearchParams(window.location.search);
      const productId = urlParams.get("id");

      // Populate the form with product details
      async function loadProductDetails() {
        try {
          const response = await fetch(
            `http://localhost:3000/get-product/${productId}`,
            {
              method: "GET",
            }
          );

          response.json().then((resp) => {
            if (resp && "product" in resp) {
              let product = resp.product;
              document.getElementById("product-id").value = product.id;
              document.getElementById("name").value = product.name;
              document.getElementById("size").value = product.size;
              document.getElementById("color").value = product.color;
              document.getElementById("price").value = product.price;
              document.getElementById("quantity").value = product.qty;
              document.getElementById("threshold").value = product.threshold;
              document.getElementById("status").value = product.status;
            } else {
              alert(resp.error);
            }
          });
        } catch (error) {
          console.error("Error loading product details:", error);
          alert("Failed to load product details.");
        }
      }

      // Call the API to update the product
      async function updateProduct() {
        const updatedProduct = {
          id: document.getElementById("product-id").value,
          name: document.getElementById("name").value,
          size: document.getElementById("size").value,
          color: document.getElementById("color").value,
          price: parseFloat(document.getElementById("price").value),
          qty: parseInt(document.getElementById("quantity").value),
          threshold: parseInt(document.getElementById("threshold").value),
          status: document.getElementById("status").value,
        };

        try {
          const response = await fetch(
            `http://localhost:3000/update-product/${updatedProduct.id}`,
            {
              method: "PUT",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify(updatedProduct),
            }
          );

          response.json().then((resp) => {
            if (resp && "success" in resp) {
              alert("Product updated successfully!");
              window.location.href = "products.html"; // Redirect to inventory list
            } else {
              alert(resp.error);
            }
          });
        } catch (error) {
          console.error("Error updating product:", error);
          alert("Failed to update product.");
        }
      }

      // Load the product details on page load
      loadProductDetails();
    </script>
  </body>
</html>
