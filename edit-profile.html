<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link href="css/login.css" rel="stylesheet" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
      rel="stylesheet"
    />
    <link href="css/login.css" rel="stylesheet" />
    <title>Edit Profile</title>
  </head>

  <body>
    <header>
      <h1>Dress Store</h1>
    </header>
    <!-- Back Icon -->
    <a href="javascript:history.back()" class="back-icon">
      <i class="fas fa-arrow-left"></i> Back
    </a>
    <main>
      <div class="login-container">
        <h2>Edit Profile</h2>
        <form id="editUserForm">
          <label>First Name</label>
          <input
            type="text"
            placeholder="First Name"
            name="firstname"
            id="firstname"
            required
          />
          <label>Last Name</label>
          <input
            type="text"
            placeholder="Last Name"
            name="lastname"
            id="lastname"
            required
          />
          <label>User Name</label>
          <input
            type="text"
            placeholder="Username"
            name="username"
            id="username"
            required
          />

          <button type="button" class="login-button" onclick="submitForm()">
            Save
          </button>
        </form>
      </div>
    </main>

    <footer>
      <p>&copy; 2024 Dress Store. All rights reserved.</p>
    </footer>

    <script>
      // Function to toggle password visibility
      function togglePasswordVisibility(fieldId) {
        const passwordField = document.getElementById(fieldId);
        const toggleIcon = document.getElementById(
          "toggle" + fieldId.charAt(0).toUpperCase() + fieldId.slice(1)
        );

        if (passwordField.type === "password") {
          passwordField.type = "text"; // Show password
          toggleIcon.classList.remove("fa-eye"); // Remove eye icon
          toggleIcon.classList.add("fa-eye-slash"); // Add eye-slash icon
        } else {
          passwordField.type = "password"; // Hide password
          toggleIcon.classList.remove("fa-eye-slash"); // Remove eye-slash icon
          toggleIcon.classList.add("fa-eye"); // Add eye icon
        }
      }

      // Function to submit the form using JavaScript (AJAX)
      function submitForm() {
        // const oldPassword = document.getElementById("oldPassword").value;
        const firstname = document.getElementById("firstname").value;
        const lastname = document.getElementById("lastname").value;
        const username = document.getElementById("username").value;
        // const newPassword = document.getElementById("password").value;

        // Make the PUT request to the /edit-user route
        fetch("http://localhost:3000/edit-user", {
          method: "PUT",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            // oldPassword,
            firstname,
            lastname,
            username,
            // newPassword, // Send the new password to be updated
          }),
        })
          .then((response) => response.json())
          .then((resp) => {
            if (resp && resp.success) {
              alert("Profile updated successfully!");
              window.location.href = "account.html"; // Redirect after success
            } else {
              alert(resp.error || "An error occurred.");
            }
          })
          .catch((error) => {
            console.error("Error:", error);
            alert("An error occurred while updating the profile.");
          });
      }

      // Fetch current user data (if needed)
      document.addEventListener("DOMContentLoaded", function () {
        fetch("http://localhost:3000/get-user")
          .then((response) => response.json())
          .then((data) => {
            if (data.user) {
              document.getElementById("firstname").value = data.user.first_name;
              document.getElementById("lastname").value = data.user.last_name;
              document.getElementById("username").value = data.user.username;
            } else {
              alert("Failed to fetch user data.");
            }
          })
          .catch((error) => {
            console.error("Error:", error);
            alert("Failed to fetch user data.");
          });
      });
    </script>
  </body>
</html>
