<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link href="css/login.css" rel="stylesheet" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
      rel="stylesheet"
    />
    <link href="css/login.css" rel="stylesheet" />
    <title>New user</title>
  </head>

  <body>
    <header>
      <h1>Dress Store</h1>
    </header>
    <!-- Back Icon -->
    <a href="javascript:history.back()" class="back-icon">
      <i class="fas fa-arrow-left"></i> Back
    </a>
    <main>
      <div class="login-container">
        <h2>New User</h2>
        <form id="registerForm">
          <label>First Name</label>
          <input type="text" placeholder="First Name" id="firstname" required />
          <label>Last Name</label>
          <input type="text" placeholder="Last Name" id="lastname" required />
          <label>User Name</label>
          <input type="text" placeholder="Username" id="username" required />

          <label>Password</label>
          <div class="password-container">
            <input type="password" id="password" required />
            <!-- Password Toggler Icon -->
            <i
              class="fas fa-eye"
              id="togglePassword"
              onclick="togglePasswordVisibility()"
            ></i>
          </div>
          <button type="submit" class="login-button">Save</button>
        </form>
      </div>
    </main>

    <footer>
      <p>&copy; 2024 Dress Store. All rights reserved.</p>
    </footer>

    <script>
      // Function to toggle password visibility
      function togglePasswordVisibility() {
        const passwordField = document.getElementById("password");
        const toggleIcon = document.getElementById("togglePassword");

        if (passwordField.type === "password") {
          passwordField.type = "text"; // Show password
          toggleIcon.classList.remove("fa-eye"); // Remove eye icon
          toggleIcon.classList.add("fa-eye-slash"); // Add eye-slash icon
        } else {
          passwordField.type = "password"; // Hide password
          toggleIcon.classList.remove("fa-eye-slash"); // Remove eye-slash icon
          toggleIcon.classList.add("fa-eye"); // Add eye icon
        }
      }

      // Handle form submission with AJAX (JavaScript)
      document
        .getElementById("registerForm")
        .addEventListener("submit", async function (event) {
          event.preventDefault();

          // Gather form data
          const firstName = document.getElementById("firstname").value;
          const lastName = document.getElementById("lastname").value;
          const username = document.getElementById("username").value;
          const password = document.getElementById("password").value;

          // Validate form data
          if (!firstName || !lastName || !username || !password) {
            alert("All fields are required!");
            return;
          }

          // Send a POST request using fetch to the /register route
          try {
            const response = await fetch("http://localhost:3000/register", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify({ firstName, lastName, username, password }),
            });

            response.json().then((resp) => {
              if (resp && "success" in resp) {
                alert("User registered successfully!");
                window.location.href = "account.html";
              } else {
                alert(resp.error);
              }
            });
          } catch (error) {
            alert("An error occurred. Please try again.");
            console.error(error);
          }
        });
    </script>
  </body>
</html>
