<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
      rel="stylesheet"
    />
    <link href="css/login.css" rel="stylesheet" />
    <link href="css/alert.css" rel="stylesheet" />
    <title>Add Product - Dress Store</title>
  </head>

  <body>
    <header>
      <h1>Dress Store</h1>
    </header>
    <!-- Back Icon -->
    <a href="javascript:history.back()" class="back-icon">
      <i class="fas fa-arrow-left"></i> Back
    </a>
    <main>
      <div class="login-container">
        <!-- Alert Section (Hidden by default) -->
        <div id="alert" class="alert alert-hidden">
          <p id="alertMessage"></p>
          <button id="closeAlert" class="close-alert">x</button>
        </div>
        <h2>New Dress</h2>
        <form id="addProductForm">
          <label>Name</label>
          <input type="text" id="name" required />
          <label>Size</label>
          <input type="text" id="size" required />
          <label>Color</label>
          <input type="text" id="color" required />
          <label>Price</label>
          <input type="number" id="price" required />
          <label>Quantity</label>
          <input type="number" id="qty" required />
          <label>Threshold Quantity</label>
          <input type="number" id="threshold" required />
          <label>Status</label>
          <select id="status" required>
            <option value="available">Available</option>
            <option value="finished">Finished</option>
          </select>

          <button type="submit" class="login-button">Save</button>
        </form>
      </div>
    </main>

    <footer>
      <p>&copy; 2024 Dress Store. All rights reserved.</p>
    </footer>

    <script>
      // Handle form submission
      const form = document.getElementById("addProductForm");
      const messageElement = document.getElementById("message");

      form.addEventListener("submit", async (event) => {
        event.preventDefault(); // Prevent default form submission

        // Collect form data
        const name = document.getElementById("name").value;
        const size = document.getElementById("size").value;
        const color = document.getElementById("color").value;
        const price = parseFloat(document.getElementById("price").value);
        const qty = parseInt(document.getElementById("qty").value, 10);
        const threshold = parseInt(
          document.getElementById("threshold").value,
          10
        );
        const status = document.getElementById("status").value;

        try {
          // Send a POST request to the /add-product API
          const response = await fetch("http://localhost:3000/add-product", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({
              name,
              size,
              color,
              price,
              qty,
              threshold,
              status,
            }),
          });

          response.json().then((resp) => {
            if (resp && "success" in resp) {
              showAlert("success", "Product added successfully!");
              form.reset(); // Clear the form
            } else {
              showAlert("error", resp.error);
            }
          });
        } catch (error) {
          showAlert("error", "An error occurred. Please try again.");
        }
      });

      function showAlert(type, message) {
        const alertBox = document.getElementById("alert");
        const alertMessage = document.getElementById("alertMessage");

        // Set the appropriate type class (success or error)
        alertBox.className = `alert alert-${type}`;
        alertMessage.textContent = message;

        // Show the alert with animation
        alertBox.classList.add("show");
        setTimeout(() => {
          alertBox.classList.add("alert-hidden");
        }, 3000);
      }

      document.getElementById("closeAlert").addEventListener("click", () => {
        const alertBox = document.getElementById("alert");
        alertBox.classList.remove("show");
        setTimeout(() => {
          alertBox.classList.add("alert-hidden");
        }, 500); // Wait for the slide-out animation to complete before hiding
      });
    </script>
  </body>
</html>
