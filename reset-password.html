<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link href="css/login.css" rel="stylesheet" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
      rel="stylesheet"
    />
    <link href="css/login.css" rel="stylesheet" />
    <link href="css/reset.css" rel="stylesheet" />
    <title>Reset Password</title>
  </head>

  <body>
    <header>
      <h1>Dress Store</h1>
    </header>
    <!-- Back Icon -->
    <a href="javascript:history.back()" class="back-icon">
      <i class="fas fa-arrow-left"></i> Back
    </a>
    <main>
      <div class="login-container">
        <h2>Reset Password</h2>
        <form id="editUserForm">
          <!-- Old Password Field -->
          <label>Old Password</label>
          <div class="password-container">
            <input
              type="password"
              name="oldPassword"
              id="oldPassword"
              required
            />
            <!-- Old Password Toggler Icon -->
            <i
              class="fas fa-eye"
              id="toggleOldPassword"
              onclick="togglePasswordVisibility('oldPassword')"
            ></i>
          </div>

          <!-- New Password Field -->
          <label>New Password</label>
          <div class="password-container">
            <input type="password" name="password" id="password" required />
            <!-- New Password Toggler Icon -->
            <i
              class="fas fa-eye"
              id="togglePassword"
              onclick="togglePasswordVisibility('password')"
            ></i>
          </div>

          <button type="button" class="login-button" onclick="submitForm()">
            Save
          </button>
        </form>
      </div>
    </main>

    <footer>
      <p>&copy; 2024 Dress Store. All rights reserved.</p>
    </footer>

    <script>
      // Function to toggle password visibility
      function togglePasswordVisibility(fieldId) {
        const passwordField = document.getElementById(fieldId);
        const toggleIcon = document.getElementById(
          "toggle" + fieldId.charAt(0).toUpperCase() + fieldId.slice(1)
        );

        if (passwordField.type === "password") {
          passwordField.type = "text"; // Show password
          toggleIcon.classList.remove("fa-eye"); // Remove eye icon
          toggleIcon.classList.add("fa-eye-slash"); // Add eye-slash icon
        } else {
          passwordField.type = "password"; // Hide password
          toggleIcon.classList.remove("fa-eye-slash"); // Remove eye-slash icon
          toggleIcon.classList.add("fa-eye"); // Add eye icon
        }
      }

      // Function to submit the form using JavaScript (AJAX)
      function submitForm() {
        const oldPassword = document.getElementById("oldPassword").value;
        const newPassword = document.getElementById("password").value;

        // Make the PUT request to the /edit-user route
        fetch("http://localhost:3000/reset-pass", {
          method: "PUT",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            oldPassword,
            newPassword, // Send the new password to be updated
          }),
        })
          .then((response) => response.json())
          .then((resp) => {
            if (resp && resp.success) {
              alert("Password updated successfully!");
              window.location.href = "account.html"; // Redirect after success
            } else {
              alert(resp.error || "An error occurred.");
            }
          })
          .catch((error) => {
            console.error("Error:", error);
            alert("An error occurred while updating the profile.");
          });
      }
    </script>
  </body>
</html>
